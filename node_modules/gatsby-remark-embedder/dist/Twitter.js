"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getHTML = exports.shouldTransform = void 0;

var _url = require("url");

var _nodeFetch = _interopRequireDefault(require("node-fetch"));

const shouldTransform = url => {
  const {
    host,
    pathname
  } = new _url.URL(url);
  return ['twitter.com', 'www.twitter.com'].includes(host) && pathname.includes('/status/');
};

exports.shouldTransform = shouldTransform;

const getHTML = url => (0, _nodeFetch.default)(`https://publish.twitter.com/oembed?url=${url}&dnt=true&omit_script=true`).then(r => r.json()).then(r => [r.html].map(s => s.replace(/\?ref_src=twsrc.*?fw/g, '')).map(s => s.replace(/<br>/g, '<br />')).join('').trim());

exports.getHTML = getHTML;